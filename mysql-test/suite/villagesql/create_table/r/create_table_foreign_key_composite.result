CREATE TABLE signal_definitions (
sensor_id INT,
frequency COMPLEX,
description VARCHAR(50),
PRIMARY KEY (sensor_id, frequency)
);
CREATE TABLE logged_data (
log_id INT PRIMARY KEY,
ref_sensor_id INT,
ref_frequency COMPLEX,
signal_value DOUBLE,
FOREIGN KEY (ref_sensor_id, ref_frequency)
REFERENCES signal_definitions(sensor_id, frequency)
ON UPDATE CASCADE
ON DELETE RESTRICT
);
SHOW CREATE TABLE logged_data;
Table	Create Table
logged_data	CREATE TABLE `logged_data` (
  `log_id` int NOT NULL,
  `ref_sensor_id` int DEFAULT NULL,
  `ref_frequency` vsql_complex.COMPLEX DEFAULT NULL,
  `signal_value` double DEFAULT NULL,
  PRIMARY KEY (`log_id`),
  KEY `ref_sensor_id` (`ref_sensor_id`,`ref_frequency`),
  CONSTRAINT `logged_data_ibfk_1` FOREIGN KEY (`ref_sensor_id`, `ref_frequency`) REFERENCES `signal_definitions` (`sensor_id`, `frequency`) ON DELETE RESTRICT ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
INSERT INTO signal_definitions VALUES
(101, '(1.0,0.0)', 'Fundamental'),
(101, '(2.0,0.0)', 'First Harmonic'),
(102, '(1.0,0.0)', 'Fundamental');
SELECT * FROM signal_definitions ORDER BY sensor_id, frequency;
sensor_id	frequency	description
101	(1,0)	Fundamental
101	(2,0)	First Harmonic
102	(1,0)	Fundamental
INSERT INTO logged_data VALUES (1, 101, '(1.0,0.0)', 5.5);
INSERT INTO logged_data VALUES (2, 101, '(2.0,0.0)', 7.8);
INSERT INTO logged_data VALUES (3, 102, '(1.0,0.0)', 9.2);
SELECT * FROM logged_data ORDER BY log_id;
log_id	ref_sensor_id	ref_frequency	signal_value
1	101	(1,0)	5.5
2	101	(2,0)	7.8
3	102	(1,0)	9.2
INSERT INTO logged_data VALUES (4, 101, '(3.0,0.0)', 9.9);
ERROR 23000: Cannot add or update a child row: a foreign key constraint fails (`test`.`logged_data`, CONSTRAINT `logged_data_ibfk_1` FOREIGN KEY (`ref_sensor_id`, `ref_frequency`) REFERENCES `signal_definitions` (`sensor_id`, `frequency`) ON DELETE RESTRICT ON UPDATE C
INSERT INTO logged_data VALUES (5, 999, '(1.0,0.0)', 8.8);
ERROR 23000: Cannot add or update a child row: a foreign key constraint fails (`test`.`logged_data`, CONSTRAINT `logged_data_ibfk_1` FOREIGN KEY (`ref_sensor_id`, `ref_frequency`) REFERENCES `signal_definitions` (`sensor_id`, `frequency`) ON DELETE RESTRICT ON UPDATE C
INSERT INTO logged_data VALUES (6, NULL, '(1.0,0.0)', 0.0);
INSERT INTO logged_data VALUES (7, 101, NULL, 0.0);
INSERT INTO logged_data VALUES (8, NULL, NULL, 0.0);
SELECT * FROM logged_data ORDER BY log_id;
log_id	ref_sensor_id	ref_frequency	signal_value
1	101	(1,0)	5.5
2	101	(2,0)	7.8
3	102	(1,0)	9.2
6	NULL	(1,0)	0
7	101	NULL	0
8	NULL	NULL	0
UPDATE signal_definitions
SET sensor_id = 999
WHERE sensor_id = 101 AND frequency = '(1.0,0.0)';
SELECT * FROM logged_data WHERE log_id = 1;
log_id	ref_sensor_id	ref_frequency	signal_value
1	999	(1,0)	5.5
SELECT * FROM signal_definitions ORDER BY sensor_id, frequency;
sensor_id	frequency	description
101	(2,0)	First Harmonic
102	(1,0)	Fundamental
999	(1,0)	Fundamental
UPDATE signal_definitions
SET frequency = '(2.5,0.0)'
WHERE sensor_id = 101 AND frequency = '(2.0,0.0)';
SELECT * FROM logged_data WHERE log_id = 2;
log_id	ref_sensor_id	ref_frequency	signal_value
2	101	(2.5,0)	7.8
SELECT * FROM signal_definitions ORDER BY sensor_id, frequency;
sensor_id	frequency	description
101	(2.5,0)	First Harmonic
102	(1,0)	Fundamental
999	(1,0)	Fundamental
DELETE FROM signal_definitions WHERE sensor_id = 999 AND frequency = '(1.0,0.0)';
ERROR 23000: Cannot delete or update a parent row: a foreign key constraint fails (`test`.`logged_data`, CONSTRAINT `logged_data_ibfk_1` FOREIGN KEY (`ref_sensor_id`, `ref_frequency`) REFERENCES `signal_definitions` (`sensor_id`, `frequency`) ON DELETE RESTRICT ON UPDATE C
SELECT * FROM signal_definitions WHERE sensor_id = 999;
sensor_id	frequency	description
999	(1,0)	Fundamental
DELETE FROM logged_data WHERE log_id = 1;
DELETE FROM signal_definitions WHERE sensor_id = 999 AND frequency = '(1.0,0.0)';
SELECT COUNT(*) FROM signal_definitions WHERE sensor_id = 999;
COUNT(*)
0
DELETE FROM signal_definitions WHERE sensor_id = 102 AND frequency = '(1.0,0.0)';
ERROR 23000: Cannot delete or update a parent row: a foreign key constraint fails (`test`.`logged_data`, CONSTRAINT `logged_data_ibfk_1` FOREIGN KEY (`ref_sensor_id`, `ref_frequency`) REFERENCES `signal_definitions` (`sensor_id`, `frequency`) ON DELETE RESTRICT ON UPDATE C
SELECT * FROM signal_definitions WHERE sensor_id = 102;
sensor_id	frequency	description
102	(1,0)	Fundamental
SELECT * FROM signal_definitions ORDER BY sensor_id, frequency;
sensor_id	frequency	description
101	(2.5,0)	First Harmonic
102	(1,0)	Fundamental
SELECT * FROM logged_data ORDER BY log_id;
log_id	ref_sensor_id	ref_frequency	signal_value
2	101	(2.5,0)	7.8
3	102	(1,0)	9.2
6	NULL	(1,0)	0
7	101	NULL	0
8	NULL	NULL	0
DROP TABLE logged_data;
DROP TABLE signal_definitions;

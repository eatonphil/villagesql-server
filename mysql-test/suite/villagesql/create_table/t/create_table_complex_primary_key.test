# Test CREATE TABLE with COMPLEX as PRIMARY KEY
# Tests that COMPLEX type can be used as PRIMARY KEY (backed by VARBINARY)

--source include/villagesql/install_complex_extension.inc
--source include/villagesql/binlog_check_begin.inc

CREATE TABLE t1 (
    id COMPLEX PRIMARY KEY,
    name VARCHAR(50)
);

SHOW COLUMNS FROM t1;

INSERT INTO t1 VALUES ('(1.0,0.0)', 'test1');
INSERT INTO t1 VALUES ('(0.0,1.0)', 'test2');

SELECT * FROM t1;

# Test primary key constraint violation
--error ER_DUP_ENTRY
INSERT INTO t1 VALUES ('(1.0,0.0)', 'duplicate');

SELECT * FROM t1;

DROP TABLE t1;

# Alternative with explicit primary key declaration
CREATE TABLE t2 (
    complex_id COMPLEX,
    name VARCHAR(50),
    PRIMARY KEY (complex_id)
);

SHOW COLUMNS FROM t2;

INSERT INTO t2 VALUES ('(2.0,3.0)', 'explicit_pk');
INSERT INTO t2 VALUES ('(4.0,5.0)', 'another_row');

SELECT * FROM t2;

--error ER_DUP_ENTRY
INSERT INTO t2 VALUES ('(4.0,5.0)', 'duplicate');

SELECT * FROM t2;

DROP TABLE t2;

--source include/villagesql/binlog_check_end.inc
--source include/villagesql/uninstall_complex_extension.inc

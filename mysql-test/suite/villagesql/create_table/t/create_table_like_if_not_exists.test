# Test CREATE TABLE IF NOT EXISTS LIKE with COMPLEX type
# Grammar: CREATE TABLE IF NOT EXISTS table_name LIKE other_table

--source include/villagesql/install_complex_extension.inc
--source include/villagesql/binlog_check_begin.inc

CREATE TABLE source_table (
    id INT PRIMARY KEY,
    complex_value COMPLEX,
    name VARCHAR(50)
);

SHOW COLUMNS FROM source_table;

INSERT INTO source_table VALUES (1, '(1.0,2.0)', 'original');

# Create table using IF NOT EXISTS LIKE
CREATE TABLE IF NOT EXISTS t1 LIKE source_table;

SHOW COLUMNS FROM t1;

INSERT INTO t1 VALUES (1, '(3.0,4.0)', 'copied');

SELECT * FROM t1;

# Second create should not fail due to IF NOT EXISTS
CREATE TABLE IF NOT EXISTS t1 LIKE source_table;

SHOW COLUMNS FROM t1;

SELECT * FROM t1;

DROP TABLE t1;

# This should now create a new table
CREATE TABLE IF NOT EXISTS t2 LIKE source_table;

SHOW COLUMNS FROM t2;

SELECT * FROM t2;

DROP TABLE t2;
DROP TABLE source_table;

--source include/villagesql/binlog_check_end.inc
--source include/villagesql/uninstall_complex_extension.inc

# Test INSERT INTO ... (partial columns) with COMPLEX type
# Grammar: INSERT [INTO] tbl_name (col_name) VALUES (value)

# NOTE: Fully review this entire file when re-enabling - DEFAULT values for COMPLEX
# columns don't work correctly (produce warnings and NULL instead of default value)
--source include/villagesql/not_implemented_complex_type.inc

--source include/villagesql/install_complex_extension.inc

CREATE TABLE t1 (
    id INT PRIMARY KEY,
    val COMPLEX DEFAULT '(0.0,0.0)',
    val_null COMPLEX
);

# NOTE: DEFAULT values for COMPLEX don't work - they produce warnings and become NULL
# Implicit default for 'val' (will be NULL with warning) and implicit NULL for 'val_null'
INSERT INTO t1 (id) VALUES (1);

# Explicit values for 'val' with negative values and zero variants, implicit NULL for 'val_null'
INSERT INTO t1 (id, val) VALUES (2, '(1.0,2.0)');
INSERT INTO t1 (id, val) VALUES (3, '(0,0)');
INSERT INTO t1 (id, val) VALUES (4, '(-3.5,1.2)');
INSERT INTO t1 (id, val) VALUES (5, '(-0,0)');
INSERT INTO t1 (id, val) VALUES (6, '(5.0,-6.0)');
INSERT INTO t1 (id, val) VALUES (7, '(0,-0)');
INSERT INTO t1 (id, val) VALUES (8, '(-7.5,-8.5)');
INSERT INTO t1 (id, val) VALUES (9, '(-0,-0)');
INSERT INTO t1 (id, val) VALUES (10, '(9.0,10.0)');

# Only specify val_null, leaving val as implicit default (NULL with warning)
INSERT INTO t1 (id, val_null) VALUES (11, '(11.0,12.0)');
INSERT INTO t1 (id, val_null) VALUES (12, '(-13.0,14.0)');

SELECT * FROM t1 ORDER BY id;

DROP TABLE t1;

# Test NOT NULL constraint
CREATE TABLE t2 (
    id INT PRIMARY KEY,
    val COMPLEX NOT NULL,
    val_optional COMPLEX
);

# This should succeed - providing the NOT NULL column with various values
INSERT INTO t2 (id, val) VALUES (1, '(1.0,2.0)');
INSERT INTO t2 (id, val) VALUES (2, '(-3.0,4.0)');
INSERT INTO t2 (id, val, val_optional) VALUES (3, '(5.0,-6.0)', '(7.0,8.0)');
INSERT INTO t2 (id, val, val_optional) VALUES (4, '(-9.0,-10.0)', '(0,0)');
INSERT INTO t2 (id, val) VALUES (5, '(11.0,12.0)');

# This should fail - NOT NULL column 'val' not provided
# Error is "Field doesn't have a default value" not "Column cannot be null"
# because DEFAULT values don't work for COMPLEX type
--error ER_NO_DEFAULT_FOR_FIELD
INSERT INTO t2 (id, val_optional) VALUES (99, '(99.0,99.0)');

# This should also fail - explicitly setting NOT NULL column to NULL
--error ER_BAD_NULL_ERROR
INSERT INTO t2 (id, val, val_optional) VALUES (98, NULL, '(98.0,98.0)');

# Verify only the successful insert is present
SELECT * FROM t2 ORDER BY id;

DROP TABLE t2;

--source include/villagesql/uninstall_complex_extension.inc

# Test INSERT ... WITH (CTE) ... SELECT with COMPLEX type
# Grammar: INSERT ... WITH ... SELECT ...
# CTE string literals are implicitly cast to COMPLEX during INSERT.

--source include/villagesql/install_complex_extension.inc

CREATE TABLE t1 (
    id INT PRIMARY KEY,
    val COMPLEX
);

# Insert using CTE with 30+ rows including zero variants and negative values
INSERT INTO t1
WITH cte AS (
    SELECT 1 AS id, '(15.0,20.0)' AS val
    UNION ALL SELECT 2, '(-0,0)'
    UNION ALL SELECT 3, '(-7.5,-8.5)'
    UNION ALL SELECT 4, '(0,0)'
    UNION ALL SELECT 5, '(22.0,-13.0)'
    UNION ALL SELECT 6, '(0,-0)'
    UNION ALL SELECT 7, '(-18.0,9.0)'
    UNION ALL SELECT 8, '(3.5,4.2)'
    UNION ALL SELECT 9, '(-0,-0)'
    UNION ALL SELECT 10, '(11.5,-12.5)'
    UNION ALL SELECT 11, '(0,0)'
    UNION ALL SELECT 12, '(-25.0,-30.0)'
    UNION ALL SELECT 13, '(19.0,21.0)'
    UNION ALL SELECT 14, '(-0,0)'
    UNION ALL SELECT 15, '(7.0,-5.0)'
    UNION ALL SELECT 16, '(-14.0,16.0)'
    UNION ALL SELECT 17, '(0,-0)'
    UNION ALL SELECT 18, '(26.0,28.0)'
    UNION ALL SELECT 19, '(-9.5,11.5)'
    UNION ALL SELECT 20, '(-0,-0)'
    UNION ALL SELECT 21, '(33.0,-35.0)'
    UNION ALL SELECT 22, '(0,0)'
    UNION ALL SELECT 23, '(-22.0,24.0)'
    UNION ALL SELECT 24, '(17.5,19.5)'
    UNION ALL SELECT 25, '(0,-0)'
    UNION ALL SELECT 26, '(-31.0,-32.0)'
    UNION ALL SELECT 27, '(29.0,30.0)'
    UNION ALL SELECT 28, '(-0,0)'
    UNION ALL SELECT 29, '(12.0,-14.0)'
    UNION ALL SELECT 30, '(-27.0,28.0)'
    UNION ALL SELECT 31, '(0,0)'
    UNION ALL SELECT 32, '(34.0,-36.0)'
    UNION ALL SELECT 33, '(-0,-0)'
)
SELECT * FROM cte;

SELECT * FROM t1 ORDER BY id;

# Test ordering by COMPLEX column
SELECT * FROM t1 ORDER BY val, id;

DROP TABLE t1;

# Test CTE with multiple COMPLEX columns
CREATE TABLE t2 (
    id INT PRIMARY KEY,
    val_a COMPLEX,
    val_b COMPLEX,
    val_c COMPLEX
);

# Insert using CTE with multiple COMPLEX columns
INSERT INTO t2
WITH cte_multi AS (
    SELECT 1 AS id, '(1.0,2.0)' AS val_a, '(3.0,4.0)' AS val_b, '(5.0,6.0)' AS val_c
    UNION ALL SELECT 2, '(0,0)', '(-0,0)', '(0,-0)'
    UNION ALL SELECT 3, '(-7.0,8.0)', '(9.0,-10.0)', '(-11.0,-12.0)'
    UNION ALL SELECT 4, '(13.5,14.5)', '(-15.5,16.5)', '(17.5,-18.5)'
    UNION ALL SELECT 5, '(-19.0,-20.0)', '(21.0,22.0)', '(-23.0,24.0)'
    UNION ALL SELECT 6, '(0,-0)', '(24.0,-25.0)', '(-0,0)'
    UNION ALL SELECT 7, '(26.0,27.0)', '(-0,-0)', '(28.0,29.0)'
    UNION ALL SELECT 8, '(-30.0,31.0)', '(32.0,33.0)', '(0,0)'
    UNION ALL SELECT 9, '(34.0,-35.0)', '(0,0)', '(-36.0,-37.0)'
    UNION ALL SELECT 10, '(-0,0)', '(-38.0,39.0)', '(40.0,-41.0)'
    UNION ALL SELECT 11, '(42.0,43.0)', '(0,-0)', '(-44.0,45.0)'
    UNION ALL SELECT 12, '(-46.0,-47.0)', '(48.0,49.0)', '(-0,-0)'
    UNION ALL SELECT 13, '(0,0)', '(-50.0,-51.0)', '(52.0,53.0)'
    UNION ALL SELECT 14, '(54.0,-55.0)', '(56.0,57.0)', '(0,-0)'
    UNION ALL SELECT 15, '(-58.0,59.0)', '(-0,0)', '(-60.0,-61.0)'
    UNION ALL SELECT 16, '(62.0,63.0)', '(64.0,-65.0)', '(0,0)'
    UNION ALL SELECT 17, '(-0,-0)', '(66.0,67.0)', '(-68.0,69.0)'
    UNION ALL SELECT 18, '(70.0,-71.0)', '(-72.0,-73.0)', '(0,-0)'
    UNION ALL SELECT 19, '(-74.0,75.0)', '(0,0)', '(76.0,77.0)'
    UNION ALL SELECT 20, '(0,-0)', '(-78.0,79.0)', '(-0,0)'
    UNION ALL SELECT 21, '(80.0,81.0)', '(82.0,-83.0)', '(-0,-0)'
    UNION ALL SELECT 22, '(-84.0,-85.0)', '(0,-0)', '(86.0,87.0)'
    UNION ALL SELECT 23, '(88.0,89.0)', '(-90.0,91.0)', '(0,0)'
    UNION ALL SELECT 24, '(-0,0)', '(92.0,93.0)', '(-94.0,-95.0)'
    UNION ALL SELECT 25, '(96.0,-97.0)', '(-0,-0)', '(98.0,99.0)'
    UNION ALL SELECT 26, '(-100.0,101.0)', '(102.0,103.0)', '(0,-0)'
    UNION ALL SELECT 27, '(0,0)', '(-104.0,-105.0)', '(-0,0)'
    UNION ALL SELECT 28, '(106.0,107.0)', '(108.0,-109.0)', '(-0,-0)'
    UNION ALL SELECT 29, '(-110.0,-111.0)', '(0,0)', '(112.0,113.0)'
    UNION ALL SELECT 30, '(114.0,115.0)', '(-116.0,117.0)', '(0,0)'
    UNION ALL SELECT 31, '(-0,-0)', '(0,-0)', '(-118.0,-119.0)'
    UNION ALL SELECT 32, '(120.0,-121.0)', '(-0,0)', '(122.0,123.0)'
    UNION ALL SELECT 33, '(-124.0,125.0)', '(126.0,127.0)', '(0,-0)'
)
SELECT * FROM cte_multi;

SELECT * FROM t2 ORDER BY id;

# Test ordering by multiple COMPLEX columns
SELECT * FROM t2 ORDER BY val_a, val_b;
SELECT * FROM t2 ORDER BY val_b, val_c;

DROP TABLE t2;

--source include/villagesql/uninstall_complex_extension.inc

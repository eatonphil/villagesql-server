# Test INSERT INTO ... PARTITION ... with COMPLEX type
# Grammar: INSERT [INTO] tbl_name PARTITION (partition_name) ...

--source include/villagesql/install_complex_extension.inc

CREATE TABLE t1 (
    id INT,
    val COMPLEX
)
PARTITION BY RANGE (id) (
    PARTITION p0 VALUES LESS THAN (10),
    PARTITION p1 VALUES LESS THAN (20),
    PARTITION p2 VALUES LESS THAN (30),
    PARTITION p3 VALUES LESS THAN (40)
);

# Insert 30+ rows into specific partitions with zero variants and negative values
# Partition p0 (id < 10)
INSERT INTO t1 PARTITION (p0) VALUES (1, '(15.0,20.0)');
INSERT INTO t1 PARTITION (p0) VALUES (2, '(-0,0)');
INSERT INTO t1 PARTITION (p0) VALUES (3, '(-7.5,-8.5)');
INSERT INTO t1 PARTITION (p0) VALUES (4, '(0,0)');
INSERT INTO t1 PARTITION (p0) VALUES (5, '(22.0,-13.0)');
INSERT INTO t1 PARTITION (p0) VALUES (6, '(0,-0)');
INSERT INTO t1 PARTITION (p0) VALUES (7, '(-18.0,9.0)');
INSERT INTO t1 PARTITION (p0) VALUES (8, '(3.5,4.2)');
INSERT INTO t1 PARTITION (p0) VALUES (9, '(-0,-0)');

# Partition p1 (10 <= id < 20)
INSERT INTO t1 PARTITION (p1) VALUES (10, '(11.5,-12.5)');
INSERT INTO t1 PARTITION (p1) VALUES (11, '(0,0)');
INSERT INTO t1 PARTITION (p1) VALUES (12, '(-25.0,-30.0)');
INSERT INTO t1 PARTITION (p1) VALUES (13, '(19.0,21.0)');
INSERT INTO t1 PARTITION (p1) VALUES (14, '(-0,0)');
INSERT INTO t1 PARTITION (p1) VALUES (15, '(7.0,-5.0)');
INSERT INTO t1 PARTITION (p1) VALUES (16, '(-14.0,16.0)');
INSERT INTO t1 PARTITION (p1) VALUES (17, '(0,-0)');
INSERT INTO t1 PARTITION (p1) VALUES (18, '(26.0,28.0)');
INSERT INTO t1 PARTITION (p1) VALUES (19, '(-9.5,11.5)');

# Partition p2 (20 <= id < 30)
INSERT INTO t1 PARTITION (p2) VALUES (20, '(-0,-0)');
INSERT INTO t1 PARTITION (p2) VALUES (21, '(33.0,-35.0)');
INSERT INTO t1 PARTITION (p2) VALUES (22, '(0,0)');
INSERT INTO t1 PARTITION (p2) VALUES (23, '(-22.0,24.0)');
INSERT INTO t1 PARTITION (p2) VALUES (24, '(17.5,19.5)');
INSERT INTO t1 PARTITION (p2) VALUES (25, '(0,-0)');
INSERT INTO t1 PARTITION (p2) VALUES (26, '(-31.0,-32.0)');
INSERT INTO t1 PARTITION (p2) VALUES (27, '(29.0,30.0)');
INSERT INTO t1 PARTITION (p2) VALUES (28, '(-0,0)');
INSERT INTO t1 PARTITION (p2) VALUES (29, '(12.0,-14.0)');

# Partition p3 (30 <= id < 40)
INSERT INTO t1 PARTITION (p3) VALUES (30, '(-27.0,28.0)');
INSERT INTO t1 PARTITION (p3) VALUES (31, '(0,0)');
INSERT INTO t1 PARTITION (p3) VALUES (32, '(34.0,-36.0)');
INSERT INTO t1 PARTITION (p3) VALUES (33, '(-0,-0)');

# Verify all data
SELECT * FROM t1 ORDER BY id;

# Test ordering by COMPLEX column
SELECT * FROM t1 ORDER BY val, id;

# Verify partition-specific data
SELECT * FROM t1 PARTITION (p0) ORDER BY val, id;
SELECT * FROM t1 PARTITION (p1) ORDER BY id;
SELECT * FROM t1 PARTITION (p2) ORDER BY id;
SELECT * FROM t1 PARTITION (p3) ORDER BY id;

DROP TABLE t1;

# Test with multiple COMPLEX columns and partitions
CREATE TABLE t2 (
    id INT,
    val_a COMPLEX,
    val_b COMPLEX,
    val_c COMPLEX
)
PARTITION BY RANGE (id) (
    PARTITION p0 VALUES LESS THAN (10),
    PARTITION p1 VALUES LESS THAN (20),
    PARTITION p2 VALUES LESS THAN (30),
    PARTITION p3 VALUES LESS THAN (40)
);

# Insert into different partitions
INSERT INTO t2 PARTITION (p0) VALUES (1, '(1.0,2.0)', '(3.0,4.0)', '(5.0,6.0)');
INSERT INTO t2 PARTITION (p0) VALUES (2, '(0,0)', '(-0,0)', '(0,-0)');
INSERT INTO t2 PARTITION (p0) VALUES (3, '(-7.0,8.0)', '(9.0,-10.0)', '(-11.0,-12.0)');

INSERT INTO t2 PARTITION (p1) VALUES (10, '(13.5,14.5)', '(-15.5,16.5)', '(17.5,-18.5)');
INSERT INTO t2 PARTITION (p1) VALUES (11, '(-19.0,-20.0)', '(21.0,22.0)', '(-23.0,24.0)');
INSERT INTO t2 PARTITION (p1) VALUES (12, '(0,-0)', '(24.0,-25.0)', '(-0,0)');

INSERT INTO t2 PARTITION (p2) VALUES (20, '(26.0,27.0)', '(-0,-0)', '(28.0,29.0)');
INSERT INTO t2 PARTITION (p2) VALUES (21, '(-30.0,31.0)', '(32.0,33.0)', '(0,0)');
INSERT INTO t2 PARTITION (p2) VALUES (22, '(34.0,-35.0)', '(0,0)', '(-36.0,-37.0)');

INSERT INTO t2 PARTITION (p3) VALUES (30, '(-0,0)', '(-38.0,39.0)', '(40.0,-41.0)');
INSERT INTO t2 PARTITION (p3) VALUES (31, '(42.0,43.0)', '(0,-0)', '(-44.0,45.0)');
INSERT INTO t2 PARTITION (p3) VALUES (32, '(-46.0,-47.0)', '(48.0,49.0)', '(-0,-0)');

# Verify all data
SELECT * FROM t2 ORDER BY id;

# Test ordering by multiple COMPLEX columns
SELECT * FROM t2 ORDER BY val_a, val_b;
SELECT * FROM t2 ORDER BY val_b, val_c;

# Verify partition-specific data
SELECT * FROM t2 PARTITION (p0) ORDER BY id;
SELECT * FROM t2 PARTITION (p1) ORDER BY val_a, id;
SELECT * FROM t2 PARTITION (p2) ORDER BY id;
SELECT * FROM t2 PARTITION (p3) ORDER BY id;

DROP TABLE t2;

--source include/villagesql/uninstall_complex_extension.inc

# Test REPLACE INTO ... VALUES with COMPLEX type
# Grammar: REPLACE [INTO] tbl_name [(col_name [, col_name] ...)] VALUES (value_list) [, (value_list)] ...

--source include/villagesql/install_complex_extension.inc

CREATE TABLE t1 (
    id INT PRIMARY KEY,
    val COMPLEX
);

# Insert initial 10 rows with zero variants
INSERT INTO t1 VALUES
    (1, '(1.0,2.0)'),
    (2, '(0,0)'),
    (3, '(-3.5,4.5)'),
    (4, '(-0,0)'),
    (5, '(5.0,-6.0)'),
    (6, '(0,-0)'),
    (7, '(-7.5,-8.5)'),
    (8, '(-0,-0)'),
    (9, '(9.0,10.0)'),
    (10, '(0,0)');

SELECT * FROM t1 ORDER BY id;

# Replace existing rows (should delete and re-insert)
REPLACE INTO t1 VALUES (1, '(100.0,200.0)');
REPLACE INTO t1 VALUES (2, '(200.0,300.0)');

SELECT * FROM t1 ORDER BY id;

# Replace multiple existing rows
REPLACE INTO t1 VALUES (3, '(300.0,400.0)'), (4, '(400.0,500.0)');

SELECT * FROM t1 ORDER BY id;

# Insert new rows via REPLACE (no conflict)
REPLACE INTO t1 VALUES (11, '(11.0,11.0)');
REPLACE INTO t1 VALUES (12, '(12.0,12.0)'), (13, '(13.0,13.0)');

SELECT * FROM t1 ORDER BY id;

# Replace zero variant rows
REPLACE INTO t1 VALUES (6, '(600.0,600.0)'), (8, '(800.0,800.0)'), (10, '(1000.0,1000.0)');

SELECT * FROM t1 ORDER BY id;

DROP TABLE t1;

--source include/villagesql/uninstall_complex_extension.inc

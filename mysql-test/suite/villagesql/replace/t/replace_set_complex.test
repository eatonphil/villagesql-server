# Test REPLACE INTO ... SET with COMPLEX type
# Grammar: REPLACE [INTO] tbl_name SET assignment_list

--source include/villagesql/install_complex_extension.inc

CREATE TABLE t1 (
    id INT PRIMARY KEY,
    val COMPLEX
);

# Insert 10 rows with zero variants
INSERT INTO t1 VALUES
    (1, '(1.0,2.0)'),
    (2, '(0,0)'),
    (3, '(-3.5,4.5)'),
    (4, '(-0,0)'),
    (5, '(5.0,-6.0)'),
    (6, '(0,-0)'),
    (7, '(-7.5,-8.5)'),
    (8, '(-0,-0)'),
    (9, '(9.0,10.0)'),
    (10, '(0,0)');

SELECT * FROM t1 ORDER BY id;

# Replace existing rows using SET syntax
REPLACE INTO t1 SET id = 1, val = '(100.0,100.0)';
REPLACE INTO t1 SET val = '(200.0,200.0)', id = 2;

SELECT * FROM t1 ORDER BY id;

# Replace mix of existing and new rows
REPLACE INTO t1 SET id = 5, val = '(500.0,500.0)';
REPLACE INTO t1 SET val = '(1100.0,1100.0)', id = 11;
REPLACE INTO t1 SET id = 7, val = '(700.0,700.0)';

SELECT * FROM t1 ORDER BY id;

# Replace zero variant rows
REPLACE INTO t1 SET id = 6, val = '(600.0,600.0)';
REPLACE INTO t1 SET id = 8, val = '(800.0,800.0)';
REPLACE INTO t1 SET id = 10, val = '(1000.0,1000.0)';

SELECT * FROM t1 ORDER BY id;

DROP TABLE t1;

--source include/villagesql/uninstall_complex_extension.inc

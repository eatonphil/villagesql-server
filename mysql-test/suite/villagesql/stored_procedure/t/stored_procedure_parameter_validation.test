# Comprehensive test for custom type validation in stored procedures/functions
# Tests all parameter types, DECLARE variables, and function RETURNS

--source include/villagesql/install_complex_extension.inc

# Create a test table
CREATE TABLE t1 (
  id INT PRIMARY KEY,
  val COMPLEX
);

delimiter //;

# Test 1: IN parameter with COMPLEX type - should be blocked
--echo Test 1: IN parameter
--error ER_VILLAGESQL_GENERIC_ERROR
CREATE PROCEDURE sp_in(IN param COMPLEX)
BEGIN
  INSERT INTO t1 VALUES (1, param);
END//

# Test 2: DECLARE variable with COMPLEX type - should be blocked
--echo Test 2: DECLARE variable
--error ER_VILLAGESQL_GENERIC_ERROR
CREATE PROCEDURE sp_declare()
BEGIN
  DECLARE v COMPLEX;
  SET v = '(1.0,2.0)';
END//

# Test 3: Function RETURNS COMPLEX - should be blocked
--echo Test 3: Function RETURNS COMPLEX
--error ER_VILLAGESQL_GENERIC_ERROR
CREATE FUNCTION fn_returns() RETURNS COMPLEX DETERMINISTIC
BEGIN
  RETURN '(1.0,2.0)';
END//

delimiter ;//

# Cleanup
DROP TABLE t1;

--source include/villagesql/uninstall_complex_extension.inc

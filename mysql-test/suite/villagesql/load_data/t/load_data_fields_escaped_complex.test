# Test LOAD DATA ... FIELDS ESCAPED BY / ENCLOSED BY ... with COMPLEX type
# Grammar: LOAD DATA ... FIELDS TERMINATED BY ',' ENCLOSED BY '"' ESCAPED BY '\\'
# Tests two ways to specify NULL:
#   - \N with ESCAPED BY
#   - Unquoted NULL with ENCLOSED BY
# Also escapes commas with:
#   - Quotes
#   - Backslash escapes

--source include/villagesql/install_complex_extension.inc

CREATE TABLE t1 (id INT, val COMPLEX);

--write_file $MYSQLTEST_VARDIR/tmp/complex_escaped.dat
1,"(1.0,2.0)"
2,"(2.0,3.0)"
3,"(0.0,-0.0)"
4,\N
5,NULL
6,"(-3.0,-4.0)"
8,"(13e13,14.0)"
EOF

--replace_result $MYSQLTEST_VARDIR MYSQLTEST_VARDIR
--eval LOAD DATA INFILE '$MYSQLTEST_VARDIR/tmp/complex_escaped.dat' INTO TABLE t1 FIELDS TERMINATED BY ',' ENCLOSED BY '"' ESCAPED BY '\\\\'

SELECT * FROM t1 ORDER BY id;
SELECT * FROM t1 WHERE val IS NULL;

# Now also just escape commas (no ENCLOSED BY)
--remove_file $MYSQLTEST_VARDIR/tmp/complex_escaped.dat
--write_file $MYSQLTEST_VARDIR/tmp/complex_escaped.dat
11,(1.0\,2.0)
12,(2.0\,3.0)
13,(0.0\,-0.0)
14,\N
15,(-3.0\,-4.0)
18,(13e13\,14.0)
EOF

--replace_result $MYSQLTEST_VARDIR MYSQLTEST_VARDIR
--eval LOAD DATA INFILE '$MYSQLTEST_VARDIR/tmp/complex_escaped.dat' INTO TABLE t1 FIELDS TERMINATED BY ',' ESCAPED BY '\\\\'

SELECT * FROM t1 ORDER BY id;
SELECT * FROM t1 WHERE val IS NULL;

DROP TABLE t1;
--remove_file $MYSQLTEST_VARDIR/tmp/complex_escaped.dat

--source include/villagesql/uninstall_complex_extension.inc

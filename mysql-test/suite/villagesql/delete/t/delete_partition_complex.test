# Test DELETE FROM ... PARTITION ... with COMPLEX type
# Grammar: DELETE [FROM] tbl_name PARTITION (partition_name) ...

--source include/villagesql/install_complex_extension.inc

CREATE TABLE t1 (
    id INT,
    val COMPLEX
)
PARTITION BY RANGE (id) (
    PARTITION p0 VALUES LESS THAN (10),
    PARTITION p1 VALUES LESS THAN (20)
);

# Insert 10 rows across both partitions
INSERT INTO t1 VALUES
    (1, '(1.0,2.0)'),
    (2, '(0,0)'),
    (3, '(-3.5,4.5)'),
    (4, '(-0,0)'),
    (5, '(5.0,-6.0)'),
    (11, '(11.0,12.0)'),
    (12, '(0,-0)'),
    (13, '(13.0,14.0)'),
    (14, '(-0,-0)'),
    (15, '(15.0,16.0)');

SELECT * FROM t1 ORDER BY id;

# Delete specific rows from p0 partition
DELETE FROM t1 PARTITION (p0) WHERE id IN (1, 3);

SELECT * FROM t1 ORDER BY id;

# Delete specific rows from p1 partition
DELETE FROM t1 PARTITION (p1) WHERE val = '(0,0)';

SELECT * FROM t1 ORDER BY id;

# Delete all from p0 partition
DELETE FROM t1 PARTITION (p0);

SELECT * FROM t1 ORDER BY id;

DROP TABLE t1;

--source include/villagesql/uninstall_complex_extension.inc

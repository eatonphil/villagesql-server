# Test DELETE IGNORE ... with COMPLEX type
# Grammar: DELETE IGNORE ...

--source include/villagesql/install_complex_extension.inc

CREATE TABLE t1 (
    id INT PRIMARY KEY,
    val COMPLEX
);

# Insert 10 rows with zero variants
INSERT INTO t1 VALUES
    (1, '(1.0,2.0)'),
    (2, '(0,0)'),
    (3, '(-3.5,4.5)'),
    (4, '(-0,0)'),
    (5, '(5.0,-6.0)'),
    (6, '(0,-0)'),
    (7, '(-7.5,-8.5)'),
    (8, '(-0,-0)'),
    (9, '(9.0,10.0)'),
    (10, '(0,0)');

SELECT * FROM t1 ORDER BY id;

# DELETE IGNORE with WHERE
DELETE IGNORE FROM t1 WHERE id = 1;

SELECT * FROM t1 ORDER BY id;

# DELETE IGNORE multiple rows
DELETE IGNORE FROM t1 WHERE id IN (2, 4, 6);

SELECT * FROM t1 ORDER BY id;

DROP TABLE t1;

# Test DELETE IGNORE with foreign key constraint
CREATE TABLE parent (
    id INT PRIMARY KEY,
    val COMPLEX
);

CREATE TABLE child (
    id INT PRIMARY KEY,
    parent_id INT,
    FOREIGN KEY (parent_id) REFERENCES parent(id)
);

INSERT INTO parent VALUES (1, '(1.0,1.0)'), (2, '(2.0,2.0)'), (3, '(3.0,3.0)');
INSERT INTO child VALUES (1, 1), (2, 1), (3, 2);

# Without IGNORE, this would fail due to foreign key constraint
# With IGNORE, rows with foreign key references are skipped
DELETE IGNORE FROM parent WHERE id IN (1, 3);

# Verify: id=1 should not be deleted (has child references), id=3 should be deleted (no references)
SELECT * FROM parent ORDER BY id;
SELECT * FROM child ORDER BY id;

DROP TABLE child;
DROP TABLE parent;

--source include/villagesql/uninstall_complex_extension.inc

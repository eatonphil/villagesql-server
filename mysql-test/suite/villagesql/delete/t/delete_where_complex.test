# Test DELETE FROM ... WHERE complex_col = ... with COMPLEX type
# Grammar: DELETE [FROM] tbl_name WHERE ...

--source include/villagesql/install_complex_extension.inc

CREATE TABLE t1 (
    id INT PRIMARY KEY,
    val COMPLEX
);

# Insert 10 rows with zero variants
INSERT INTO t1 VALUES
    (1, '(1.0,2.0)'),
    (2, '(0,0)'),
    (3, '(-3.5,4.5)'),
    (4, '(-0,0)'),
    (5, '(5.0,-6.0)'),
    (6, '(0,-0)'),
    (7, '(-7.5,-8.5)'),
    (8, '(-0,-0)'),
    (9, '(9.0,10.0)'),
    (10, '(0,0)');

SELECT * FROM t1 ORDER BY id;

# Test = operator
DELETE FROM t1 WHERE val = '(1.0,2.0)';
SELECT * FROM t1 ORDER BY id;

# Test != operator (deletes rows that don't match)
DELETE FROM t1 WHERE val != '(0,0)';
SELECT * FROM t1 ORDER BY id;

# Reset table
DELETE FROM t1;
INSERT INTO t1 VALUES
    (1, '(1.0,2.0)'),
    (2, '(0,0)'),
    (3, '(-3.5,4.5)'),
    (4, '(-0,0)'),
    (5, '(5.0,-6.0)');

# Test deleting all zero variants with = operator
DELETE FROM t1 WHERE val = '(0,0)';
SELECT * FROM t1 ORDER BY id;

# Reset table
DELETE FROM t1;
INSERT INTO t1 VALUES
    (1, '(1.0,2.0)'),
    (2, '(0,0)'),
    (3, '(3.0,4.0)'),
    (4, '(0,0)'),
    (5, '(5.0,6.0)');

# Test IS NULL
DELETE FROM t1 WHERE val IS NULL;
SELECT * FROM t1 ORDER BY id;

# Add NULL row and test
INSERT INTO t1 VALUES (6, NULL);

SELECT * FROM t1 ORDER BY id;

DELETE FROM t1 WHERE val IS NULL;

SELECT * FROM t1 ORDER BY id;

DROP TABLE t1;

--source include/villagesql/uninstall_complex_extension.inc

# Test Advanced UNION scenarios with COMPLEX type
# Grammar: Multiple UNIONs, Global ORDER BY/LIMIT, NULL handling

--source include/villagesql/install_complex_extension.inc

CREATE TABLE t1 (val COMPLEX);
INSERT INTO t1 VALUES ('(1.0,2.0)'), ('(3.0,4.0)'), ('(0,0)');

CREATE TABLE t2 (val COMPLEX);
INSERT INTO t2 VALUES ('(1.0,2.0)'), ('(5.0,6.0)'), ('(7.0,8.0)'), ('(0,-0)');

CREATE TABLE t3 (val COMPLEX);
INSERT INTO t3 VALUES ('(3.0,4.0)'), ('(9.0,10.0)'), ('(-0,0)');

# 1. Chained UNIONs with ALL (should include duplicates)
SELECT val FROM t1 UNION ALL SELECT val FROM t2 UNION ALL SELECT val FROM t3;

# 2. Chained UNIONs with duplicate elimination
# t1 and t2 share '(1.0,2.0)', t1 and t3 share '(3.0,4.0)'
# UNION should eliminate these duplicates using comparison interface
SELECT val FROM t1 UNION SELECT val FROM t2 UNION SELECT val FROM t3 ORDER BY val;

# 3. Global ORDER BY and LIMIT on UNION result
# This forces sorting of the merged COMPLEX dataset
SELECT val FROM t1 UNION SELECT val FROM t2 ORDER BY val DESC LIMIT 3;

# 4. UNION with NULL
# Should resolve to nullable COMPLEX type
SELECT val FROM t1 UNION SELECT NULL;

# 5. Individual ORDER BY/LIMIT in parenthesized UNION
(SELECT val FROM t1 ORDER BY val DESC LIMIT 1)
UNION
(SELECT val FROM t2 ORDER BY val ASC LIMIT 1);

DROP TABLE t1;
DROP TABLE t2;
DROP TABLE t3;

--source include/villagesql/uninstall_complex_extension.inc

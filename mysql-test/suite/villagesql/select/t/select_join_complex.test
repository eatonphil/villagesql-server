# Test SELECT ... JOIN ... with COMPLEX type
# Grammar: SELECT ... JOIN ...

--source include/villagesql/install_complex_extension.inc

CREATE TABLE t1 (id INT, val COMPLEX);
INSERT INTO t1 VALUES
  (1, '(0.0,0.0)'),
  (2, '(1.0,2.0)'),
  (3, '(3.0,4.0)'),
  (4, '(-1.0,-2.0)'),
  (5, '(1.5e100,2.3e100)'),   # Very large positive
  (6, '(4.22e-10,3.14e-15)'), # Very small positive
  (7, '(-5.0,3.0)'),          # Mixed signs
  (8, '(-0,0)');

CREATE TABLE t2 (id INT, val COMPLEX);
INSERT INTO t2 VALUES
  (1, '(1.0,2.0)'),
  (2, '(3.0,4.0)'),
  (3, '(-1.0,-2.0)'),
  (4, '(5.0,6.0)'),
  (5, '(-0.0,-0.0)'),
  (6, '(4.22e-10,3.14e-15)'), # Very small (matches t1.id=6)
  (7, '(-1.5e100,-2.3e100)'); # Very large negative

# Join on INT, select COMPLEX
SELECT t1.id, t1.val, t2.val FROM t1 JOIN t2 ON t1.id = t2.id ORDER BY t1.id;

# Join on COMPLEX (exact equality)
SELECT t1.id, t1.val, t2.val FROM t1 JOIN t2 ON t1.val = t2.val ORDER BY t1.val, t1.id, t2.id;

# Join with inequality on COMPLEX
SELECT t1.id, t1.val, t2.val FROM t1 JOIN t2 ON t1.val < t2.val ORDER BY t1.id, t2.id LIMIT 5;

# Self-join on COMPLEX
CREATE TABLE t3 (id INT, val COMPLEX);
INSERT INTO t3 VALUES (1, '(2.0,3.0)'), (2, '(2.0,3.0)'), (3, '(4.0,5.0)');
SELECT a.id, b.id FROM t3 a JOIN t3 b ON a.val = b.val WHERE a.id < b.id;

# Join with NULL
INSERT INTO t1 VALUES (6, NULL);
INSERT INTO t2 VALUES (6, NULL);
SELECT t1.id FROM t1 JOIN t2 ON t1.val = t2.val WHERE t1.id = 6;

DROP TABLE t1, t2, t3;

--source include/villagesql/uninstall_complex_extension.inc

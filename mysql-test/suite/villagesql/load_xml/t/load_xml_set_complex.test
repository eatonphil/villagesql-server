# Test LOAD XML ... SET ... with COMPLEX type
# Grammar: LOAD XML ... SET col = expr ...

--source include/villagesql/install_complex_extension.inc

CREATE TABLE t1 (id INT, val COMPLEX);

# Test varied complex values including edge cases
--write_file $MYSQLTEST_VARDIR/tmp/complex_set.xml
<rows>
  <row>
    <id>1</id>
    <val>(1.0,2.0)</val>
  </row>
  <row>
    <id>2</id>
    <val>(0,0)</val>
  </row>
  <row>
    <id>3</id>
    <val>(3.0,4.0)</val>
  </row>
  <row>
    <id>4</id>
    <val>(-0,0)</val>
  </row>
  <row>
    <id>5</id>
    <val>(5.0,6.0)</val>
  </row>
  <row>
    <id>6</id>
    <val></val>
  </row>
  <row>
    <id>7</id>
    <val>(-0,-0)</val>
  </row>
</rows>
EOF

--replace_result $MYSQLTEST_VARDIR MYSQLTEST_VARDIR
# Load val into @val first (user variable name must match XML tag name)
--eval LOAD XML INFILE '$MYSQLTEST_VARDIR/tmp/complex_set.xml' INTO TABLE t1 ROWS IDENTIFIED BY '<row>' (id, @val) SET val = @val

SELECT * FROM t1 ORDER BY id;

DROP TABLE t1;
--remove_file $MYSQLTEST_VARDIR/tmp/complex_set.xml

--source include/villagesql/uninstall_complex_extension.inc

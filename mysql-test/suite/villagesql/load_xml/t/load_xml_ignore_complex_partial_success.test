# Test LOAD XML IGNORE with COMPLEX type - partial success
# Grammar: LOAD XML ... IGNORE ...
# Tests that: duplicate key skips row, bad value skips row, good row succeeds

--source include/villagesql/install_complex_extension.inc

CREATE TABLE t1 (id INT PRIMARY KEY, val COMPLEX);
INSERT INTO t1 VALUES (1, '(1.0,2.0)'), (2, '(0.0,-0.0)');

SELECT * FROM t1 ORDER BY id;

--write_file $MYSQLTEST_VARDIR/tmp/complex_ignore.xml
<rows>
  <row>
    <id>1</id>
    <val>(5.0,6.0)</val>
  </row>
  <row>
    <id>3</id>
    <val>not_complex</val>
  </row>
  <row>
    <id>5</id>
    <val>(-1,-1)</val>
  </row>
</rows>
EOF

--replace_result $MYSQLTEST_VARDIR MYSQLTEST_VARDIR
# Row id 1 is a duplicate and row id 3 is a bad value. Row id 5 is fine.
--eval LOAD XML INFILE '$MYSQLTEST_VARDIR/tmp/complex_ignore.xml' IGNORE INTO TABLE t1 ROWS IDENTIFIED BY '<row>'

SELECT * FROM t1 ORDER BY id;

DROP TABLE t1;
--remove_file $MYSQLTEST_VARDIR/tmp/complex_ignore.xml

--source include/villagesql/uninstall_complex_extension.inc

# Test VIEW with GROUP BY on COMPLEX column
# This test verifies grouping/aggregation on COMPLEX columns in views

--source include/villagesql/install_complex_extension.inc

CREATE TABLE t1 (id INT PRIMARY KEY, val COMPLEX, amount DECIMAL(10,2));

INSERT INTO t1 VALUES
  (1, '(1,2)', 100.00),
  (2, '(3,4)', 200.00),
  (3, '(1,2)', 150.00),
  (4, '(5,6)', 175.00),
  (5, '(3,4)', 225.00);

# Create view with GROUP BY on COMPLEX column
CREATE VIEW v_grouped AS
SELECT val, COUNT(*) AS count, SUM(amount) AS total
FROM t1
GROUP BY val;

# Query the view - should return aggregated results by COMPLEX value
SELECT * FROM v_grouped ORDER BY count DESC;

DROP VIEW v_grouped;
DROP TABLE t1;

--source include/villagesql/uninstall_complex_extension.inc

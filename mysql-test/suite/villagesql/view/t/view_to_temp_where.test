# Test temporary table created from view with WHERE on COMPLEX column
# This tests if the bug is specific to view-on-view or affects view materialization in general

--source include/villagesql/install_complex_extension.inc

CREATE TABLE t1 (id INT PRIMARY KEY, val COMPLEX, amount DECIMAL(10,2));

INSERT INTO t1 VALUES
  (1, '(1,2)', 100.50),
  (2, '(3,4)', 200.75),
  (3, '(5,6)', 150.25),
  (4, '(7,8)', 300.00),
  (5, '(1,2)', 175.50);

# Create view with WHERE on numeric column
CREATE VIEW v_level1 AS
SELECT id, val, amount FROM t1 WHERE amount > 150;

SELECT * FROM v_level1 ORDER BY id;

# Create temporary table from view with WHERE on COMPLEX column
CREATE TEMPORARY TABLE temp_from_view AS
SELECT id, val, amount FROM v_level1 WHERE val = '(1,2)';

SELECT * FROM temp_from_view ORDER BY id;

DROP TEMPORARY TABLE temp_from_view;
DROP VIEW v_level1;
DROP TABLE t1;

--source include/villagesql/uninstall_complex_extension.inc

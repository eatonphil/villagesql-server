# Test VIEW with LEFT/RIGHT JOIN on COMPLEX column

--source include/villagesql/install_complex_extension.inc

CREATE TABLE t1 (id INT PRIMARY KEY, val COMPLEX, description VARCHAR(50));
CREATE TABLE t2 (id INT PRIMARY KEY, val COMPLEX, category VARCHAR(50));

INSERT INTO t1 VALUES
  (1, '(1,2)', 'First value'),
  (2, '(3,4)', 'Second value'),
  (3, '(5,6)', 'Third value');

INSERT INTO t2 VALUES
  (10, '(1,2)', 'Category A'),
  (20, '(3,4)', 'Category B'),
  (30, '(7,8)', 'Category C');

# View with LEFT JOIN on COMPLEX column
CREATE VIEW v_left_join AS
SELECT t1.id AS t1_id, t1.val, t1.description, t2.id AS t2_id, t2.category
FROM t1 LEFT JOIN t2 ON t1.val = t2.val;

SELECT * FROM v_left_join ORDER BY t1_id;

# View with RIGHT JOIN on COMPLEX column
CREATE VIEW v_right_join AS
SELECT t1.id AS t1_id, t1.val AS t1_val, t2.id AS t2_id, t2.val AS t2_val, t2.category
FROM t1 RIGHT JOIN t2 ON t1.val = t2.val;

SELECT * FROM v_right_join ORDER BY t2_id;

DROP VIEW v_left_join;
DROP VIEW v_right_join;
DROP TABLE t1;
DROP TABLE t2;

--source include/villagesql/uninstall_complex_extension.inc

# Test DELETE through updatable VIEW with COMPLEX column

--source include/villagesql/install_complex_extension.inc

CREATE TABLE t1 (id INT PRIMARY KEY, val COMPLEX, description VARCHAR(100));

INSERT INTO t1 VALUES
  (1, '(1,2)', 'First'),
  (2, '(3,4)', 'Second'),
  (3, '(5,6)', 'Third');

# Create simple updatable view
CREATE VIEW v1 AS
SELECT id, val, description FROM t1;

# Initial count
SELECT COUNT(*) AS initial_count FROM v1;

# Test DELETE through view
DELETE FROM v1 WHERE id = 2;

# Verify row was deleted
SELECT COUNT(*) AS final_count FROM v1;

# Verify deletion in base table
SELECT COUNT(*) FROM t1 WHERE id = 2;

DROP VIEW v1;
DROP TABLE t1;

--source include/villagesql/uninstall_complex_extension.inc

CREATE TABLE t1 (
id INT PRIMARY KEY,
name VARCHAR(50)
);
INSERT INTO t1 VALUES (1, 'test1'), (2, 'test2');
ALTER TABLE t1 ADD COLUMN val COMPLEX INVISIBLE;
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `id` int NOT NULL,
  `name` varchar(50) DEFAULT NULL,
  `val` vsql_complex.COMPLEX DEFAULT NULL /*!80023 INVISIBLE */,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
SELECT * FROM t1 ORDER BY id;
id	name
1	test1
2	test2
UPDATE t1 SET val = '(1.0,1.0)' WHERE id = 1;
UPDATE t1 SET val = '(2.0,2.0)' WHERE id = 2;
SELECT id, val, name FROM t1 ORDER BY id;
id	val	name
1	(1,1)	test1
2	(2,2)	test2
DROP TABLE t1;
CREATE TABLE t2 (
id INT PRIMARY KEY,
val COMPLEX,
name VARCHAR(50)
);
INSERT INTO t2 VALUES (1, '(1.0,1.0)', 'visible');
SELECT * FROM t2;
id	val	name
1	(1,1)	visible
ALTER TABLE t2 MODIFY COLUMN val COMPLEX INVISIBLE;
SHOW CREATE TABLE t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `id` int NOT NULL,
  `val` vsql_complex.COMPLEX DEFAULT NULL /*!80023 INVISIBLE */,
  `name` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
SELECT * FROM t2;
id	name
1	visible
SELECT id, val, name FROM t2;
id	val	name
1	(1,1)	visible
ALTER TABLE t2 MODIFY COLUMN val COMPLEX;
SHOW CREATE TABLE t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `id` int NOT NULL,
  `val` vsql_complex.COMPLEX DEFAULT NULL,
  `name` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
SELECT * FROM t2;
id	val	name
1	(1,1)	visible
DROP TABLE t2;
CREATE TABLE t3 (
id INT PRIMARY KEY,
val COMPLEX INVISIBLE,
name VARCHAR(50)
);
INSERT INTO t3 (id, val, name) VALUES (1, '(1.0,1.0)', 'test');
SELECT * FROM t3;
id	name
1	test
SELECT id, val, name FROM t3;
id	val	name
1	(1,1)	test
ALTER TABLE t3 DROP COLUMN val;
SHOW CREATE TABLE t3;
Table	Create Table
t3	CREATE TABLE `t3` (
  `id` int NOT NULL,
  `name` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
SELECT id, val, name FROM t3;
ERROR 42S22: Unknown column 'val' in 'field list'
DROP TABLE t3;
CREATE TABLE t4 (
id INT PRIMARY KEY,
val COMPLEX INVISIBLE
);
INSERT INTO t4 (id, val) VALUES (1, '(1.0,1.0)'), (2, '(2.0,2.0)'), (3, '(1.0,1.0)');
ALTER TABLE t4 ADD INDEX idx_val (val);
SHOW CREATE TABLE t4;
Table	Create Table
t4	CREATE TABLE `t4` (
  `id` int NOT NULL,
  `val` vsql_complex.COMPLEX DEFAULT NULL /*!80023 INVISIBLE */,
  PRIMARY KEY (`id`),
  KEY `idx_val` (`val`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
EXPLAIN SELECT id, val FROM t4 WHERE val = '(1.0,1.0)';
id	select_type	table	partitions	type	possible_keys	key	key_len	ref	rows	filtered	Extra
1	SIMPLE	t4	NULL	ref	idx_val	idx_val	19	const	2	100.00	Using where; Using index
Warnings:
Note	1003	/* select#1 */ select `test`.`t4`.`id` AS `id`,`test`.`t4`.`val` AS `val` from `test`.`t4` where (`test`.`t4`.`val` = '(1,1)')
SELECT id, val FROM t4 WHERE val = '(1.0,1.0)' ORDER BY id;
id	val
1	(1,1)
3	(1,1)
ALTER TABLE t4 DROP INDEX idx_val;
SHOW CREATE TABLE t4;
Table	Create Table
t4	CREATE TABLE `t4` (
  `id` int NOT NULL,
  `val` vsql_complex.COMPLEX DEFAULT NULL /*!80023 INVISIBLE */,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
DROP TABLE t4;

# Test UPDATE ... SET col=NULL ... with COMPLEX type
# Grammar: UPDATE ... SET col_name = NULL ...

--source include/villagesql/install_complex_extension.inc

CREATE TABLE t1 (
    id INT PRIMARY KEY,
    val COMPLEX
);

# Insert 10 rows with varied values including zero variants and some NULLs
INSERT INTO t1 VALUES
    (1, '(1.0,2.0)'),
    (2, NULL),
    (3, '(-3.5,4.5)'),
    (4, '(-0,0)'),
    (5, '(5.0,-6.0)'),
    (6, NULL),
    (7, '(-7.5,-8.5)'),
    (8, '(0,0)'),
    (9, '(9.0,10.0)'),
    (10, '(0,-0)');

# Update a non-NULL value to NULL
UPDATE t1 SET val = NULL WHERE id = 1;

SELECT * FROM t1 ORDER BY id;

# Update multiple values to NULL
UPDATE t1 SET val = NULL WHERE id IN (3, 5, 7);

SELECT * FROM t1 ORDER BY id;

# Update zero variants to NULL using inequality operator
UPDATE t1 SET val = NULL WHERE val <= '(0,0)';

SELECT * FROM t1 ORDER BY id;

# Update NULL back to a value
UPDATE t1 SET val = '(99.0,99.0)' WHERE id = 2;

SELECT * FROM t1 ORDER BY id;

# Update all remaining NULLs to a value
UPDATE t1 SET val = '(-1.0,-1.0)' WHERE val IS NULL;

SELECT * FROM t1 ORDER BY id;

DROP TABLE t1;

--source include/villagesql/uninstall_complex_extension.inc

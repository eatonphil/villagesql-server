# Test UPDATE ... SET col=expr ... with COMPLEX type
# Grammar: UPDATE ... SET assignment_list ...

--source include/villagesql/install_complex_extension.inc

CREATE TABLE t1 (
    id INT PRIMARY KEY,
    val COMPLEX
);

INSERT INTO t1 VALUES (1, '(1.0,2.0)'), (2, '(3.0,4.0)');

# String expressions require explicit casting to custom types
--error ER_VILLAGESQL_GENERIC_ERROR
UPDATE t1 SET val = CONCAT('(', '5.0', ',', '6.0', ')') WHERE id = 1;

SELECT * FROM t1 ORDER BY id;

# UPDATE with explicit conversion of string expression
UPDATE t1 SET val = VSQL_COMPLEX.COMPLEX_FROM_STRING(CONCAT('(', '5.0', ',', '6.0', ')')) WHERE id = 1;

SELECT * FROM t1 ORDER BY id;

DROP TABLE t1;

--source include/villagesql/uninstall_complex_extension.inc

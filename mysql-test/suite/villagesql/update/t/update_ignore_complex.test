# Test UPDATE IGNORE ... with COMPLEX type
# Grammar: UPDATE IGNORE ...

# NOTE: Disabled due to broken UPDATE IGNORE behavior - incorrectly allows NULL in NOT NULL columns
--source include/villagesql/not_implemented_complex_type.inc

--source include/villagesql/install_complex_extension.inc

CREATE TABLE t1 (
    id INT PRIMARY KEY,
    val COMPLEX NOT NULL,
    name VARCHAR(50)
);

INSERT INTO t1 VALUES
    (1, '(1.0,2.0)', 'one'),
    (2, '(0,0)', 'two'),
    (3, '(-3.5,4.5)', 'three'),
    (4, '(5.0,-6.0)', 'four'),
    (5, '(7.0,8.0)', 'five'),
    (6, '(9.0,10.0)', 'six');

# First verify UPDATE without IGNORE fails with NOT NULL violation
--error 1048
UPDATE t1 SET val = NULL WHERE id = 1;

# Verify no change occurred
SELECT * FROM t1 ORDER BY id;

# Now try with IGNORE - should silently skip the NULL update
UPDATE IGNORE t1 SET val = NULL WHERE id = 1;

# Verify the value was NOT updated (error was ignored)
SELECT * FROM t1 ORDER BY id;

# Try to update multiple rows to NULL with IGNORE
UPDATE IGNORE t1 SET val = NULL WHERE id IN (2, 3);

# Verify none were updated
SELECT * FROM t1 ORDER BY id;

# Test UPDATE IGNORE with valid updates (no errors to suppress)
UPDATE IGNORE t1 SET val = '(100.0,100.0)' WHERE id IN (4, 5);

SELECT * FROM t1 ORDER BY id;

# Test UPDATE IGNORE with mixed valid and invalid updates
UPDATE IGNORE t1 SET val = NULL, name = 'updated' WHERE id = 6;

# Verify name was NOT updated (entire update was skipped due to NULL constraint)
SELECT * FROM t1 ORDER BY id;

# Test UPDATE IGNORE attempting to set all rows to NULL
UPDATE IGNORE t1 SET val = NULL;

# Verify no rows were updated to NULL
SELECT * FROM t1 ORDER BY id;

DROP TABLE t1;

--source include/villagesql/uninstall_complex_extension.inc

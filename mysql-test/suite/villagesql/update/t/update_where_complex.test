# Test UPDATE ... WHERE complex_col = ... with COMPLEX type
# Grammar: UPDATE ... WHERE ...

--source include/villagesql/install_complex_extension.inc

CREATE TABLE t1 (
    id INT PRIMARY KEY,
    val COMPLEX
);

# Insert 10 rows with zero variants and duplicates
INSERT INTO t1 VALUES
    (1, '(1.0,2.0)'),
    (2, '(0,0)'),
    (3, '(1.0,2.0)'),
    (4, '(-0,0)'),
    (5, '(5.0,-6.0)'),
    (6, '(0,-0)'),
    (7, '(1.0,2.0)'),
    (8, '(-0,-0)'),
    (9, '(5.0,-6.0)'),
    (10, '(0,0)');

# Update based on COMPLEX column equality
UPDATE t1 SET val = '(100.0,100.0)' WHERE val = '(1.0,2.0)';

SELECT * FROM t1 ORDER BY id;

# Update based on zero value (all variants should match)
UPDATE t1 SET val = '(200.0,200.0)' WHERE val = '(0,0)';

SELECT * FROM t1 ORDER BY id;

# Update based on another COMPLEX value
UPDATE t1 SET val = '(300.0,300.0)' WHERE val = '(5.0,-6.0)';

SELECT * FROM t1 ORDER BY id;

DROP TABLE t1;

--source include/villagesql/uninstall_complex_extension.inc

# Test UPDATE t1, t2 SET ... with COMPLEX type
# Grammar: UPDATE table_references SET ...

--source include/villagesql/install_complex_extension.inc

CREATE TABLE t1 (
    id INT PRIMARY KEY,
    val COMPLEX
);

CREATE TABLE t2 (
    id INT PRIMARY KEY,
    modifier COMPLEX
);

# Insert 10 rows in t1 with zero variants
INSERT INTO t1 VALUES
    (1, '(1.0,2.0)'),
    (2, '(0,0)'),
    (3, '(-3.5,4.5)'),
    (4, '(-0,0)'),
    (5, '(5.0,-6.0)'),
    (6, '(0,-0)'),
    (7, '(-7.5,-8.5)'),
    (8, '(-0,-0)'),
    (9, '(9.0,10.0)'),
    (10, '(0,0)');

# Insert matching rows in t2 (only some IDs)
INSERT INTO t2 VALUES
    (1, '(10.0,10.0)'),
    (3, '(20.0,20.0)'),
    (5, '(30.0,30.0)'),
    (7, '(40.0,40.0)'),
    (9, '(50.0,50.0)');

# Multi-table update matching rows
UPDATE t1, t2 SET t1.val = '(100.0,100.0)' WHERE t1.id = t2.id;

SELECT * FROM t1 ORDER BY id;

# Multi-table update with both tables being updated
UPDATE t1, t2 SET t1.val = '(200.0,200.0)', t2.modifier = '(300.0,300.0)' WHERE t1.id = t2.id AND t1.id IN (1, 3);

SELECT * FROM t1 ORDER BY id;
SELECT * FROM t2 ORDER BY id;

# Multi-table update with JOIN syntax
UPDATE t1 JOIN t2 ON t1.id = t2.id SET t1.val = '(500.0,500.0)' WHERE t1.id >= 5;

SELECT * FROM t1 ORDER BY id;

DROP TABLE t1;
DROP TABLE t2;

--source include/villagesql/uninstall_complex_extension.inc

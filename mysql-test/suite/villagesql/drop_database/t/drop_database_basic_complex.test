# Test basic DROP DATABASE containing tables with COMPLEX columns
# Grammar: DROP DATABASE database_name

--source include/villagesql/install_complex_extension.inc
--source include/villagesql/binlog_check_begin.inc

CREATE DATABASE test_complex_db;
USE test_complex_db;

CREATE TABLE t1 (
    id INT PRIMARY KEY,
    value COMPLEX
);

CREATE TABLE t2 (
    id INT PRIMARY KEY,
    data COMPLEX
);

INSERT INTO t1 VALUES (1, '(1.0,2.0)');
INSERT INTO t2 VALUES (1, '(3.0,4.0)');

# Verify database and tables exist
SHOW DATABASES LIKE 'test_complex_db';
SHOW TABLES;

# Verify the custom_columns entry
--source include/villagesql/query_custom_columns.inc

USE test;

DROP DATABASE test_complex_db;

# Verify database no longer exists
SHOW DATABASES LIKE 'test_complex_db';

# Verify the custom_columns entry is gone
--source include/villagesql/query_custom_columns.inc

--source include/villagesql/binlog_check_end.inc
--source include/villagesql/uninstall_complex_extension.inc

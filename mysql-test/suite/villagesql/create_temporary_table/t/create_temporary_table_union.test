# Test CREATE TEMPORARY TABLE with UNION on COMPLEX columns
# Tests that custom types work correctly with UNION operations
# which create implicit temporary tables to combine results

--source include/villagesql/install_complex_extension.inc

CREATE TABLE t1 (id INT, val COMPLEX);
CREATE TABLE t2 (id INT, val COMPLEX);

INSERT INTO t1 VALUES (1, '(2,0)'), (2, '(10,0)'), (3, '(-1,0)');
INSERT INTO t2 VALUES (4, '(5,0)'), (5, '(10,0)'), (6, '(2,0)');

# Test 1: UNION removes duplicates
CREATE TEMPORARY TABLE temp_union AS
SELECT val FROM t1
UNION
SELECT val FROM t2;

# Verify metadata
SHOW COLUMNS FROM temp_union;

# Verify data - should have 4 unique values: (2,0), (10,0), (-1,0), (5,0)
SELECT * FROM temp_union ORDER BY val;

DROP TABLE temp_union;

# Test 2: UNION ALL keeps duplicates
CREATE TEMPORARY TABLE temp_union_all AS
SELECT val FROM t1
UNION ALL
SELECT val FROM t2;

# Should have 6 rows (all from both tables)
SELECT * FROM temp_union_all ORDER BY val;

DROP TABLE temp_union_all;

# Test 3: UNION with additional columns
CREATE TEMPORARY TABLE temp_union_multi AS
SELECT id, val, 'table1' AS source FROM t1
UNION
SELECT id, val, 'table2' AS source FROM t2;

SHOW COLUMNS FROM temp_union_multi;
SELECT * FROM temp_union_multi ORDER BY val, source;

DROP TABLE temp_union_multi;
DROP TABLE t2;
DROP TABLE t1;

--source include/villagesql/uninstall_complex_extension.inc

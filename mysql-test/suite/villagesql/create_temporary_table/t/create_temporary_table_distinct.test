# Test CREATE TEMPORARY TABLE with DISTINCT on COMPLEX column
# Tests that custom types work correctly with DISTINCT operations
# which create implicit temporary tables internally

--source include/villagesql/install_complex_extension.inc

CREATE TABLE t1 (id INT, val COMPLEX, category VARCHAR(50));

INSERT INTO t1 VALUES
  (1, '(2,0)', 'A'),
  (2, '(2,0)', 'B'),
  (3, '(10,0)', 'A'),
  (4, '(-1,0)', 'C'),
  (5, '(10,0)', 'B');

# Test 1: Implicit DISTINCT (uses temp table internally)
SELECT DISTINCT val FROM t1 ORDER BY val;

# Test 2: Explicit temp table with DISTINCT on COMPLEX column
CREATE TEMPORARY TABLE temp_unique AS
SELECT DISTINCT val FROM t1;

# Verify metadata
SHOW COLUMNS FROM temp_unique;

# Verify data
SELECT * FROM temp_unique ORDER BY val;

# Test 3: DISTINCT with multiple columns including COMPLEX
DROP TABLE temp_unique;

CREATE TEMPORARY TABLE temp_unique AS
SELECT DISTINCT val, category FROM t1;

SHOW COLUMNS FROM temp_unique;
SELECT * FROM temp_unique ORDER BY val, category;

DROP TABLE temp_unique;
DROP TABLE t1;

--source include/villagesql/uninstall_complex_extension.inc

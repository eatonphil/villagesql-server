# Test VEF Support for Extension UDFs
call mtr.add_suppression("Orphaned expansion directory found but not removed");
# restart: --veb-dir=MYSQLTEST_VARDIR/veb
# Create test extension with VEF-enabled UDFs (uses VEF registration)
Creating extension vef_test_ext using SDK...
Created vef_test_ext.veb
# Install extension
INSTALL EXTENSION vef_test_ext;
#
# Test VEF_WRAP_FROM_STRING
#
# Call VEF-wrapped UDF from SQL - test basic functionality
SELECT HEX(vef_test_ext.byte_array_from_string('[1, 2, 3]')) AS result;
result
010203
# Test NULL input
SELECT vef_test_ext.byte_array_from_string(NULL) AS result;
result
NULL
# Test invalid format returns NULL
SELECT vef_test_ext.byte_array_from_string('not an array') AS result;
result
NULL
# Test hex format
SELECT HEX(vef_test_ext.byte_array_from_string('[0x0A, 0x0B, 0x0C]')) AS result;
result
0A0B0C
#
# Test VEF_WRAP_COMPARE
#
# Compare functions NEVER return NULL. Instead, they treat NULL as a
# concrete value for ordering purposes:
#   - NULL == NULL  (returns 0)
#   - NULL < non-NULL (returns -1)
#   - non-NULL > NULL (returns 1)
#
# Test basic comparison: equal values
SELECT vef_test_ext.byte_array_compare('[1, 2, 3]', '[1, 2, 3]') AS result;
result
0
# Test basic comparison: first < second
SELECT vef_test_ext.byte_array_compare('[1, 2, 3]', '[1, 2, 4]') AS result;
result
-1
# Test basic comparison: first > second
SELECT vef_test_ext.byte_array_compare('[1, 2, 4]', '[1, 2, 3]') AS result;
result
1
# Test comparison with different lengths: shorter < longer
SELECT vef_test_ext.byte_array_compare('[1, 2]', '[1, 2, 3]') AS result;
result
1
# Test comparison with different lengths: longer > shorter
SELECT vef_test_ext.byte_array_compare('[1, 2, 3]', '[1, 2]') AS result;
result
-1
#
# Test VEF_WRAP_COMPARE NULL handling (NEVER returns NULL)
#
# NULL vs NULL: should return 0 (equal), NOT NULL
SELECT vef_test_ext.byte_array_compare(NULL, NULL) AS result;
result
0
# NULL vs non-NULL: should return -1 (NULL < non-NULL), NOT NULL
SELECT vef_test_ext.byte_array_compare(NULL, '[1, 2, 3]') AS result;
result
-1
# non-NULL vs NULL: should return 1 (non-NULL > NULL), NOT NULL
SELECT vef_test_ext.byte_array_compare('[1, 2, 3]', NULL) AS result;
result
1
# Verify compare result is never NULL by using IS NULL check
SELECT vef_test_ext.byte_array_compare(NULL, NULL) IS NULL AS is_null_result;
is_null_result
0
# Uninstall extension
UNINSTALL EXTENSION vef_test_ext;
# Verify UDF is removed (falls through to stored function lookup)
SELECT vef_test_ext.byte_array_from_string('[1, 2, 3]');
ERROR 42000: FUNCTION vef_test_ext.byte_array_from_string does not exist
include/rpl/deprecated/show_binlog_events.inc
